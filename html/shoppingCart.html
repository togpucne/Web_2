<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../boostrap/all.min.css">
    <link rel="stylesheet" href="../boostrap/bootstrap.min.css">
    <link rel="stylesheet" href="../fontawesome-free-6.6.0-web/fontawesome-free-6.6.0-web/css/all.min.css">

    <title>JudoAnde</title>
    <link rel="shortcut icon" href="../imgs/225186191-ch198176a-c195179-t195170n.svg" type="image/x-icon">
    <!-- product -->
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/font-awesome.css">
    <link rel="stylesheet" href="../css/templatemo-hexashop.css">
    <link rel="stylesheet" href="../css/owl-carousel.css">
    <!--end product  -->
    <link rel="stylesheet" href="../css/home.css">
    <link rel="stylesheet" href="../css/shopping.css">
</head>

<body>

    <!-- </header> -->
    <header class="inner-header">
        <nav class="navbar navbar-expand-lg navbar-dark inner-content">
            <div class="container">
                <a class="navbar-brand i1" href="../html/home.html">
                    <img src="../imgs/Remove-bg.ai_1725192433075.png" alt="">
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse inner-menu" id="navbarNav">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active z1">
                            <a class="nav-link" href="../html/home.html" style="color: whitesmoke;">Home</a>
                        </li>
                        <li class="nav-item z1">
                            <a class="nav-link" href="../html/products.html" style="color: whitesmoke;">Products</a>
                        </li>
                        <li class="nav-item z1">
                            <a class="nav-link" href="../html/about.html" style="color: whitesmoke;">About</a>
                        </li>
                        <li class="nav-item z1">
                            <a class="nav-link" href="../html/contact.html" style="color: whitesmoke;">Contact</a>
                        </li>
                        <li class="nav-item z1">
                            <a class="nav-link" href="../html/sitemap.html" style="color: whitesmoke;">Sitemap</a>
                        </li>
                    </ul>
                    <div class="d-none d-lg-block">
                        <form class="form-inline my-2 my-lg-0 inner-search">
                            <input class="form-control mr-sm-2" type="search" placeholder="Search..."
                                aria-label="Search" style="border: none; background-color: #F0F0F0;">
                            <button type="submit" class="btn my-2 my-sm-0">
                                <i class="fa fa-search"></i>
                            </button>
                        </form>
                    </div>
                    <ul class="navbar-nav">
                        <li class="nav-item" id="userProfile">
                            <a class="nav-link" href="./login.html" style="color: whitesmoke;">
                                <i class="fa-solid fa-user-plus"></i>
                            </a>
                        </li>

                        <li class="nav-item" id="userGreeting" style="display: none;">
                            <a class="nav-link" href="./infoPersonal.html" style="color: whitesmoke;">

                                <span id="userName"></span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./shopping.html" style="color: whitesmoke;">
                                <i class="fa-solid fa-cart-shopping"></i>
                                <span id="cartCount"
                                    style="color: black; font-weight: bold; position: absolute; top: 0px; right: -3px; font-size: 14px;"></span>
                            </a>
                        </li>


                </div>
            </div>
        </nav>
    </header>
    <style>
        .shopping {
            margin-top: 100px;
            margin-bottom: 20px;
        }

        .table-header,
        .table-row {
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .table-header>div,
        .table-row>div {
            flex: 1;
            text-align: center;
        }

        .shopping .container .inner-box .inner-title {
            font-size: 20px;
            font-weight: bold;
            color: red;
        }
    </style>



    <!-- End header -->
    <div class="shopping">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="inner-box">
                        <span class="inner-title">THÔNG TIN SẢN PHẨM THÊM VÀO GIỎ HÀNG </span>
                        <div class="table-responsive">
                            <div class="table-header d-flex justify-content-between">
                                <div>STT</div>
                                <div>Sản phẩm</div>
                                <div>Số lượng</div>
                                <div>Giá</div>
                                <div>Tổng tiền</div>
                                <div>Mua Hàng</div>
                                <div>Hủy Giỏ Hàng</div>

                            </div>
                            <div class="table-body" id="cartBody">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="shoppingCart">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <a href="../html/shopping.html">--> Chuyển đến sản phẩm đã được đặt hàng </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal HTML -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document"> <!-- Added modal-dialog-centered class -->
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">THÔNG TIN CẦN ĐIỀN</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="userInfoForm">
                        <div class="form-group">
                            <label for="name">Họ Tên:</label>
                            <input type="text" class="form-control" id="name" placeholder="Enter your name" required>
                            <p class="result_name">*</p>
                        </div>
                        <div class="form-group">
                            <label for="phone">Số Điện Thoại:</label>
                            <input type="text" class="form-control" id="phone" placeholder="Enter your phone number"
                                required>
                            <p class="result_phone">*</p>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="btnSubmit">Mua Hàng</button>
                </div>
            </div>
        </div>
    </div>





    <!-- footer -->
    <footer class="inner-footer fixed-footer">
        <div class="container">
            <div class="row">
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6">
                    <div class="inner-box1">
                        <img src="../imgs/Remove-bg.ai_1725192433075.png" alt="" class="img-footer">
                        <span class="inner-desc">
                            Được quản lý bởi công ty JUDOANDE
                        </span>
                    </div>
                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6">
                    <div class="inner-box2">
                        <h2>Contact Information:</h2>
                        <span>
                            <i class="fa-solid fa-location-crosshairs"></i> Nguyen Van Bao, P5, Q.GV, HCM.
                        </span> <br>
                        <span>
                            <i class="fa-solid fa-phone-volume"></i> 0933.44.0262
                        </span> <br>
                        <span>
                            <i class="fa-solid fa-envelope"></i> Email: judoande@gmail.com
                        </span>
                        </h2>
                    </div>

                </div>
                <div class="col-xl-4 col-lg-4 col-md-4 col-sm-6">
                    <div class="inner-box3">
                        <div class="inner-title">
                            <h2>Pay:</h2>
                        </div>
                        <div class="inner-pay">
                            <a href="#"><img src="../imgs/pay/pay_1.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_7.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_6.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_5.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_4.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_3.webp" alt=""></a>
                            <a href="#"><img src="../imgs/pay/pay_2.webp" alt=""></a>
                        </div>

                    </div>

                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="inner-main">
                        <div class="inner-box">
                            <a href="#"> <i class="fa-brands fa-facebook"></i>
                            </a>
                            <a href="#">
                                <i class="fa-brands fa-twitter"></i>

                            </a>
                            <a href="#">
                                <i class="fa-brands fa-tiktok"></i>

                            </a>
                            <a href="#">
                                <i class="fa-brands fa-instagram"></i>

                            </a>
                            <a href="#">
                                <i class="fa-brands fa-google"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- end footer -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const cartCount = document.getElementById("cartCount");

            // Lấy số lượng sản phẩm trong giỏ hàng từ localStorage và hiển thị
            const cartCountValue = localStorage.getItem('cartCount');
            cartCount.textContent = cartCountValue > 0 ? cartCountValue : '';

            // Phần còn lại của mã của bạn để hiển thị các sản phẩm trong giỏ hàng (nếu có)
            const cartBody = document.getElementById("cartBody");
            const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];

            // Kiểm tra nếu giỏ hàng trống
            if (cartItems.length === 0) {
                cartBody.innerHTML = `<div class="table-row d-flex justify-content-between" id="emptyRow">
                    <div colspan="9" class="text-center">Chưa có sản phẩm được thêm vào giỏ hàng!</div>
                </div>`;
            } else {
                // Hiển thị sản phẩm trong giỏ hàng
                cartItems.forEach((item, index) => {
                    const row = document.createElement("div");
                    row.className = "table-row d-flex justify-content-between";
                    row.innerHTML = `
                        <div>${index + 1}</div>
                        <div>${item.product}</div>
                        <div>${item.quantity}</div>
                        <div>${item.price}</div>
                        <div>${item.total}</div>
                        <div>
                            <button class="buy-btn" style="padding:5px 20px; border-radius: 10px; margin-right: 10px;" 
                                    data-index="${index}" 
                                    data-toggle="modal" 
                                    data-target="#myModal">Mua</button>
                        </div>
                        <div>
                            <button class="cancel-btn" style="padding:5px 20px; border-radius: 10px" 
                                    data-index="${index}">Hủy</button>
                        </div>
                    `;
                    cartBody.appendChild(row);
                });

                // Xử lý sự kiện hủy sản phẩm trong giỏ hàng
                document.querySelectorAll('.cancel-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = e.target.getAttribute('data-index');
                        cancelCartItem(index);
                    });
                });

                // Xử lý sự kiện mua sản phẩm
                document.querySelectorAll('.buy-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const index = e.target.getAttribute('data-index');
                        showModalForPurchase(index);
                    });
                });
            }
        });

        let isValid = true;

        // Hàm kiểm tra tên
        function validateName() {
            const name = document.querySelector("#name");
            const namePattern = /^(([A-Z][a-z]*\s)+([A-Z][a-z]*))$/;
            const nameInput = name.value.trim();
            const result_name = document.querySelector(".result_name");

            if (nameInput === "") {
                result_name.innerHTML = "Không được bỏ trống!";
                result_name.style.color = "red";
                name.classList.add("inner-error");
                name.classList.remove("inner-success");
                isValid = false;
            } else if (!namePattern.test(nameInput)) {
                result_name.innerHTML = "Phải từ 2 chữ số, mỗi chữ từ 2 từ đảo lên, không có khoảng trắng thừa!";
                result_name.style.color = "red";
                name.classList.add("inner-error");
                name.classList.remove("inner-success");
                isValid = false;
            } else {
                result_name.innerHTML = "Confirm name!";
                result_name.style.color = "green";
                name.classList.remove("inner-error");
                name.classList.add("inner-success");
                isValid = true;
            }
        }

        // Hàm kiểm tra số điện thoại
        function validatePhone() {
            const phone = document.querySelector("#phone");
            const phonePattern = /^0\d{9}$/;
            const phoneInput = phone.value.trim();
            const result_phone = document.querySelector(".result_phone");

            if (phoneInput === "") {
                result_phone.innerHTML = "Không được bỏ trống!";
                result_phone.style.color = "red";
                phone.classList.add("inner-error");
                phone.classList.remove("inner-success");
                isValid = false;
            } else if (!phonePattern.test(phoneInput)) {
                result_phone.innerHTML = "Số điện thoại không hợp lệ! Phải bắt đầu bằng 0 và có 10 chữ số.";
                result_phone.style.color = "red";
                phone.classList.add("inner-error");
                phone.classList.remove("inner-success");
                isValid = false;
            } else {
                result_phone.innerHTML = "Confirm phone number!";
                result_phone.style.color = "green";
                phone.classList.remove("inner-error");
                phone.classList.add("inner-success");
                isValid = true;
            }
        }

        // Thêm sự kiện blur cho các trường input
        document.querySelector("#name").addEventListener("blur", validateName);
        document.querySelector("#phone").addEventListener("blur", validatePhone);

        // Hàm xử lý khi nhấn "Mua" trong modal
        document.getElementById("btnSubmit").addEventListener("click", () => {
            validateName();
            validatePhone();

            if (isValid) {
                const name = document.getElementById("name").value.trim();
                const phone = document.getElementById("phone").value.trim();
                const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

                // Lấy đơn hàng hiện có từ localStorage
                const existingOrders = JSON.parse(localStorage.getItem("orders")) || [];

                // Lưu thông tin người mua và chi tiết giỏ hàng vào localStorage
                const orderDetails = cartItems.map((item, index) => ({
                    stt: existingOrders.length + index + 1, // Cập nhật STT
                    name: name,
                    phone: phone,
                    product: item.product,
                    quantity: item.quantity,
                    price: item.price,
                    total: item.total
                }));

                // Kết hợp đơn hàng mới vào đơn hàng đã có
                const updatedOrders = [...existingOrders, ...orderDetails];
                localStorage.setItem("orders", JSON.stringify(updatedOrders));

                // Xóa sản phẩm khỏi giỏ hàng sau khi mua
                localStorage.setItem("cartItems", JSON.stringify([])); // Xóa giỏ hàng

                // Chuyển sang trang shopping.html
                window.location.href = "../html/shopping.html";
            }
        });

        // Hàm hủy sản phẩm trong giỏ hàng
        function cancelCartItem(index) {
            let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
            cartItems.splice(index, 1);
            localStorage.setItem("cartItems", JSON.stringify(cartItems));
            location.reload();
        }
    </script>













    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="../boostrap/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="../boostrap/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
        integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
        crossorigin="anonymous"></script>
    <!-- product -->
    <!-- jQuery -->
    <script src="../js/jquery-2.1.0.min.js"></script>
    <!-- Plugins -->
    <script src="../js/owl-carousel.js"></script>
    <!-- Global Init -->
    <script src="../js/custom.js"></script>
    <!-- nav.js -->
    <script src="../js/nav.js"></script>
    <!-- slick nav  -->
    <script src="../js/slick_nav.js"></script>

    <!-- slick Sign Out -->
    <script src="../js/slick_Sign_Out.js"></script>

</body>

</html>